{% extends "/base/default-page.html" %}

{% block default_head %}
    <link rel="stylesheet" href="{{ url_for('static', filename='node_modules/leaflet/dist/leaflet.css') }}">
	<script src="{{ url_for('static', filename='node_modules/leaflet/dist/leaflet.js') }}"></script>
{% endblock default_head %}

{% block content %}
<div id="mapdisplay" style="height: 60vh"></div>
<button id="getpoint">get points</button>

<script type="text/python">
	from browser import document, window, ajax, bind
	import json

	leaflet = window.L
	renderer = leaflet.canvas({"padding": 0.5})

	marker_opts = {
		"stroke": False,
		"radius": 8,
		"color": '#ff8833',
		"renderer": renderer
	}
	

	lmap = leaflet.map("mapdisplay",{"preferCanvas": True})

	leaflet.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png", {
		"maxZoom": 18,
		"attribution": '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
	}).addTo(lmap)

	lmap.setView([13, 100.8], 6)

	def hotspot_get(req):
		hotspots = json.loads(req.text)
		for spot in hotspots:
			coords = (float(spot['latitude']), float(spot['longitude']))
			leaflet.circleMarker(coords, marker_opts).addTo(lmap)

	@bind("#getpoint", 'click')
	def get_point(ev):
		req = ajax.Ajax()
		req.bind('complete', hotspot_get)

		req.open('GET', '/hotspots', True)
		req.send()
	


</script>
{% endblock content %}
